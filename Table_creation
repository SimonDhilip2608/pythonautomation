-- Create tables for PostgreSQL with constraints
CREATE TABLE IF NOT EXISTS LoggingApps (
    app_id SERIAL PRIMARY KEY,
    log_source TEXT NOT NULL,
    app_name TEXT NOT NULL,
    description TEXT
);

CREATE TABLE IF NOT EXISTS LoggingAppFields (
    field_id SERIAL PRIMARY KEY,
    logging_app_id INTEGER NOT NULL,
    app_transaction_id TEXT NOT NULL,
    app_transaction_id_description TEXT,
    CONSTRAINT fk_logging_app
        FOREIGN KEY (logging_app_id)
        REFERENCES LoggingApps (app_id)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS AppEnrichmentAPI (
    app_api_id SERIAL PRIMARY KEY,
    logging_app_id INTEGER NOT NULL,
    endpoint_name TEXT NOT NULL,
    endpoint_url TEXT NOT NULL,
    api_type TEXT NOT NULL,
    request_schema TEXT,
    response_schema TEXT,
    CONSTRAINT fk_logging_app_api
        FOREIGN KEY (logging_app_id)
        REFERENCES LoggingApps (app_id)
        ON DELETE CASCADE
);

-- Create indexes for performance optimization
CREATE INDEX IF NOT EXISTS idx_logging_app_fields_app_id 
    ON LoggingAppFields (logging_app_id);

CREATE INDEX IF NOT EXISTS idx_app_enrichment_api_app_id 
    ON AppEnrichmentAPI (logging_app_id);
